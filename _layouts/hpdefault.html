<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.png?">
<link href="https://fonts.googleapis.com/css?family=Crimson+Text|Julius+Sans+One|Oswald" rel="stylesheet">
<link href="http://fonts.cdnfonts.com/css/harry-potter" rel="stylesheet">
</head>

<style>
.comment-like {
  margin:auto;min-width:60%;max-width:80%;table-layout: fixed;border-collapse: collapse;text-align:center;vertical-align:center;
}
a {
text-decoration: none;
}
a:not(.maintitle) {
  color: inherit;
}
a:not(.maintitle):hover {
  color:#9900cc;
}
body {
  position:relative;
  background-image: linear-gradient(to right, #0B2A38, #12383F, #071E35, #011D31);
  top:0;
  left:0;
  padding:0;
  margin:0;
}
#stars {
  z-index:-1;
  position:absolute;
  top:200pt;
  left:0;
  background-image:url("https://www.pngkey.com/png/full/42-425480_stars-sky-galaxy-effects-overlay-background-illustration.png");
  background-repeat:repeat;
  height: calc(100% - 200pt);
  width:100%;
}
#main {
  z-index:0;
   background-repeat: no-repeat;
  background-position-x:center;
  background-position-y:bottom;
  left:0;
  bottom:0;
display:flex;
flex-wrap: wrap;
flex-direction:row;
align-content:flex-start;
  justify-content: center;
}

#main .story {
  z-index:2;
  border: 1px solid;
  box-shadow: 5px 10px;
  margin:2%;
  padding:2%;
  min-width: 150px;
  max-width: 200px;
  min-height: 150px;
  max-height: 200px;
  flex: 1 0 20%;
  display: flex;
  background-color:#C5B96D;
  color:black;
  text-align:center;
  align-items: center;
  font-family: "Crimson Text";
  font-size:14pt;
}
#main .story:hover {
  background-color:#FBD308;
  opacity:0.97;
  cursor:pointer;
}
.footer {
  font-family: "Crimson Text", Georgia;
  text-align:center;
  width:100%;
  padding:3%;
  font-size:85%;
}
</style>
<body>
<div id="stars">
</div>
<div style="text-align:center;display:block"><a class="maintitle" href="https://torokmarkwerner.github.io/hp-fanfiction">
<h1 style="text-align:center;color:#FBD308">
<img style="height:200pt;margin-bottom:-60px" src="https://torokmarkwerner.github.io/title.png" /><br><span style="font-family: 'Oswald', Helvetica Neue;font-size: 26pt;">√âS A HETEDIK C√âSEK</span>
</h1></a>
</div>
<div id="main">

  {% if page.title != "HP Fanfiction | Kezd≈ëlap" %}
  <div style="color: black;background-color: #C5B96D;margin: 0 15%;padding: 5%;">
    <h2>{{page.title}}</h2>
    <p style="font-size: 80%;">√çrta: {{page.author | upcase}}</p>
    <table class="comment-like" style="min-width: 15%;max-width: 80%;margin:0">
      <tbody>
        <tr>
          <td><img src="https://d33v4339jhl8k0.cloudfront.net/docs/assets/55e7171d90336027d77078f6/images/5a75c4a22c7d3a4a4198c56a/file-Og6PGLfTD5.png" width="30px" /></td>
          <td>0</td>
          <td><img id="heart" style="filter: brightness(500%);" src="https://www.freepnglogos.com/uploads/heart-png/emoji-heart-33.png" width="30px" /></td>
          <td>0</td>
        </tr>
      </tbody>
      </table>
<style>
#heart:hover {
  cursor:pointer;
}
</style>      

<script>
        var name = "{{page.author | json}}"
      function sendPlusOne() {
      xhr = new XMLHttpRequest();
      dataTable = "https://script.google.com/macros/s/AKfycbzh61GzScy5bCNPDFL_6d_CDwTljnu3oNY6VfdUtQMVfhIbB3h-fAMybRemOgFAe_iL/exec"
      xhr.open('POST', dataTable, true);
      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      xhr.send('name=' + encodeURI(name));
      document.getElementById("heart").removeEventListener("click",sendPlusOne)
      document.getElementById("heart").style.filter = "brightness(100%)"
      document.getElementById("heart").style.cursor = "inherit"
      document.getElementById("heart").parentElement.nextElementSibling.innerText = Number(document.getElementById("heart").parentElement.nextElementSibling.innerText) + 1
      }
      document.getElementById("heart").addEventListener("click",sendPlusOne)

  dataTable = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQzsfeZNjSPfjP0yTllvKxjgDJvMQx1-ifLSC4vl1xQ2DEyRmGADAAF1HB7itpEzcAZjaAUdO8y3I4p/pub?output=csv"
  xhr=new XMLHttpRequest();
  xhr.open("GET", dataTable, false);
    xhr.onreadystatechange = function () {
        if(xhr.readyState === 4) {
            if(xhr.status === 200 || xhr.status == 0) {
               	data = xhr.responseText.split(/\n/);
						}
        }
    }
    xhr.send();
scoreTable = {}
for (i=1;i<data.length;i++) {
name = data[i].split(",")[0];
score = Number(data[i].split(",")[1]);
scoreTable[name] = score;
}
document.getElementById("heart").parentElement.nextElementSibling.innerText = scoreTable[name];

      </script>

    <p>{{page.content}}</p>
  {% else %}
  {{page.content}}
  {% endif %}

  <div class="footer" style="flex-grow:1">
    <p>
    <a href="https://torokmarkwerner.github.io" target="_blank">TM</a> üßô, 7C | 2022 </p><p>
    H√°tt√©r: <a href="https://www.vladislavpantic.com/" target="_blank">Vladislav Pantic</a></p></div>
    </div>
</div>

<script>
  function loadXMLDoc() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        
        posts = []
        columns = this.responseText.split("\r\n")[0].split(",").length; //For possible future purposes.
        data = this.responseText.split("\r\n");
        
        
        for (i=0; i<data.length; i++) {
        if (data[i].split(",")[3] === window.location.href.split("#")[0] && data[i].split(",")[8] === "1") {
        postObject = {
        "date":data[i].split(",")[0],
        "name":data[i].split(",")[1],
        "comment":data[i].split(",")[2],
        "link":data[i].split(",")[3],
        "recaptcha":data[i].split(",")[4],
        "post-id":data[i].split(",")[5],
        "reply-to":data[i].split(",")[6],
        "reply-to-name":data[i].split(",")[7],
        "moderated":data[i].split(",")[8]
        }
        posts.push(postObject)
        }
        }
      
        numCom = posts.length;
        postCommentNumber = document.createElement("DIV");
        if (numCom<2) {postCommentNumber.innerHTML = numCom + " comment"} else {postCommentNumber.innerHTML = numCom + " comments"};
        postCommentNumber.className = "post-comment-number"
        document.getElementsByClassName("footer")[0].prepend(postCommentNumber);
        
        for (i=0;i<posts.length;i++) {
        commentBody = document.createElement("DIV");
        commentBody.setAttribute("id",posts[i]["post-id"]);
        
        header = document.createElement("DIV");
        header.className = "post-comment-header"
   commenterName = document.createElement("SPAN");
   commenterName.className = "post-comment-name"
   commenterName.innerText = posts[i].name;
   date = document.createElement("SPAN");
   date.className = "post-comment-date"
   date.innerText = posts[i].date;
   header.appendChild(commenterName);
   header.appendChild(date);
   
   comment = document.createElement("DIV");
   if (posts[i]["reply-to"] === "") {
   comment.innerText = decodeURIComponent(posts[i].comment);
   } else {
   comment.innerHTML = "<a href='#" + posts[i]["reply-to"] + "'>@" + posts[i]["reply-to-name"] + "</a> " + decodeURIComponent(posts[i].comment);
   }
   comment.style.backgroundColor = "lightgoldenrodyellow";
   comment.className = "post-comment-content"
   
   replyDiv = document.createElement("DIV");
   replyDiv.style.display = "flex";
   replyDiv.style.justifyContent = "flex-end"
   replyDiv.className = "reply-button-container"
   
   reply = document.createElement("BUTTON");
   reply.className = "reply-button";
   reply.innerText = "Reply";
   replyDiv.appendChild(reply)
   
   commentBody.className = "post-comment";
   
   commentBody.appendChild(header)
   commentBody.appendChild(comment)
   commentBody.appendChild(replyDiv)
   
   document.getElementsByClassName("footer")[0].previousElementSibling.appendChild(commentBody)
        }
        
        
        replyButtons = document.getElementsByClassName("reply-button");
        for (i=0; i<replyButtons.length; i++) {
        replyButtons[i].addEventListener("click",function(){
        replyTo = this.parentElement.parentElement.id
        replyToName = this.parentElement.parentElement.children[0].children[0].innerText
        document.getElementById("leave-a-comment").classList.add("leave-a-comment1");
        for (i=0; i<replyButtons.length; i++) {
        replyButtons[i].parentElement.style.display = "flex"
        replyButtons[i].style.display = "block"
        if (replyButtons[i].nextElementSibling) {
        replyButtons[i].nextElementSibling.remove()
        }
        }
        this.style.display = "none";
        document.getElementsByClassName("comment-form-container")[document.getElementsByClassName("comment-form-container").length-1].style.display = "block"
        document.getElementsByClassName("comment-form-container")[document.getElementsByClassName("comment-form-container").length-1].style.display = "none"
     
        this.parentElement.style.display = "block";
            sampleForm =  document.createElement("DIV");
     sampleForm.innerHTML = '<table style="width:100%"><tbody><tr><td style="width:50%"><div style="width:100%"><input type="text" style="width:100%" placeholder="Name"></div></td><td style="width:50%"><div style="display:flex;align-items:center;"><input type="checkbox"><label>I <i>am</i> a robot.</label></div></td></tr><tr><td colspan="2"><textarea style="width:100%;height:15vh;resize:none" placeholder="Write your comment here"></textarea></td></tr><tr><td colspan="2"> <div style="display:flex;justify-content:flex-end;padding: 0.5em 1em 1em 0em;"><button class="submit-button">Submit</button></div></td></tr></tbody></table>'
          //alert(sampleForm.innerHTML)
        this.parentElement.appendChild(sampleForm)
         
          
        submitButton();
        })
        }
        //document.getElementById("demo").innerHTML = JSON.stringify(posts)
      }
    };
    xhttp.open("GET", "https://docs.google.com/spreadsheets/d/e/2PACX-1vQg6dmeH1EYHwCm1zLmGSI34IC9Uchtf8pWL3KfqnPIMbSbFl-DB1jptcCjuIlP3e4mRVmcG7PbGuGz/pub?gid=0&single=true&output=csv", true);
    xhttp.send();
   }
  </script>


</body>
  
</html>
